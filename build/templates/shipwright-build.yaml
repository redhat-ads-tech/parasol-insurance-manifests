apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: {{ .Values.image.name }}
  namespace: {{ .Values.namespace }}
spec:
  source:
    type: Git
    git:
      url: "https://{{ .Values.gitlab.host }}/parasol/parasol-insurance.git"
      cloneSecret: gitlab-credentials
  strategy:
    name: buildah
    kind: ClusterBuildStrategy
  paramValues:
    - name: dockerfile
      value: Containerfile
  output:
    image: "{{ .Values.registry.host }}/{{ .Values.registry.organization }}/{{ .Values.image.name }}:latest"
    pushSecret: quay-push-secret
  retention:
    succeededLimit: 5
    failedLimit: 3
